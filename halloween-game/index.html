<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ä¸‡åœ£èŠ‚éšæœºå…³å¡ Â· ç®€æ˜“é…å¯¹ ğŸƒ</title>
<style>
  :root{
    --bg:#0b0b1a;--text:#f7f7fb;--panel:#151532;--panel2:#0f0f23;
    --tile:#1d1d36;--tile-hover:#2a2a55;--tile-selected:#3a3a7a;
    --orange:#ffb454;--violet:#7e5cef;--green:#2dd4bf;--red:#ff6b6b;
    --shadow:0 10px 30px rgba(0,0,0,.45);
  }
  html,body{height:100%;margin:0;background:
    radial-gradient(1200px 700px at 70% -200px,#1a1440 0%,#0d0b1d 40%,#070711 100%),
    var(--bg); color:var(--text); font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple Color Emoji,Noto Color Emoji;}
  *{box-sizing:border-box}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 12px}
  .title{display:flex;gap:10px;align-items:center;font-weight:900;font-size:clamp(18px,2.6vw,26px)}
  .panel{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid #27275a;border-radius:16px;padding:12px 14px;box-shadow:var(--shadow);display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .badge{padding:8px 12px;border-radius:999px;background:#1b1b3a;border:1px solid #2a2a58;font-weight:800}
  .btn{appearance:none;border:0;background:linear-gradient(180deg,#ffb454,#ff9640);color:#3b1800;padding:10px 14px;border-radius:12px;font-weight:900;cursor:pointer;box-shadow:inset 0 -2px 0 rgba(0,0,0,.15),0 8px 16px rgba(0,0,0,.25);transition:.15s transform,.15s filter}
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:linear-gradient(180deg,#8a82ff,#6c63ff);color:#0a0720}
  .btn.ghost{background:#1f1f3f;color:#c5c6ff;border:1px solid #2f2f63}
  .meter{position:relative;height:12px;background:#1b1b36;border:1px solid #2a2a52;border-radius:999px;overflow:hidden;min-width:180px}
  .fill{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,#ffb454,#ff6b6b)}
  .dim{opacity:.75}

  /* æ¸¸æˆåŒºï¼šè‡ªç”±å¸ƒå±€ */
  .stage-wrap{margin:14px 0}
  .stage{
    position:relative;
    width:100%;
    height: clamp(420px, 60vw, 640px);
    background:linear-gradient(180deg,rgba(20,20,50,.65),rgba(10,10,30,.65));
    border:1px solid #26265a;border-radius:18px;box-shadow:var(--shadow);
    overflow:hidden;
  }
  .tile{
    position:absolute; display:flex; align-items:center; justify-content:center;
    width:68px;height:68px;font-size:38px;line-height:1;
    background:var(--tile); border:1px solid #2a2a58; border-radius:18px; cursor:pointer;
    transition:.12s transform,.12s filter,.12s box-shadow,.12s background; user-select:none;
  }
  .tile:hover{background:var(--tile-hover)}
  .tile.selected{background:var(--tile-selected); box-shadow:0 0 0 3px var(--violet) inset}
  .tile.pulse{animation:pulse .8s infinite}
  @keyframes pulse{0%{filter:drop-shadow(0 0 0 rgba(126,232,250,0))}60%{filter:drop-shadow(0 0 10px rgba(126,232,250,.6))}100%{filter:drop-shadow(0 0 0 rgba(126,232,250,0))}}
  .tile.pop{animation:pop .35s both}
  @keyframes pop{0%{transform:scale(1)}30%{transform:scale(1.15)}100%{transform:scale(.1);opacity:0}}
  .overlay{position:fixed;inset:0;background:rgba(6,6,14,.75);display:none;align-items:center;justify-content:center;padding:20px;z-index:10}
  .dialog{max-width:520px;width:100%;background:linear-gradient(180deg,#161634,#0e0e22);border:1px solid #2a2a58;border-radius:18px;box-shadow:var(--shadow);padding:22px}
  .levels{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-top:10px}
  .lv{padding:12px 14px;border-radius:12px;background:#1b1b3a;border:1px solid #2a2a58;cursor:pointer;text-align:center;font-weight:800}
  footer{opacity:.8;text-align:center;margin:10px 0}
  @media (max-width:600px){.tile{width:58px;height:58px;font-size:32px}}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="title"><span>ğŸŒ•</span><span>ä¸‡åœ£èŠ‚éšæœºå…³å¡ Â· ç®€æ˜“é…å¯¹</span><span class="dim">ï¼ˆä»»æ„ä¸¤å¼ ç›¸åŒå³å¯æ¶ˆé™¤ï¼‰</span></div>
    <div class="panel">
      <span class="badge" id="score">å¾—åˆ† 0</span>
      <span class="badge" id="combo">è¿å‡» x1</span>
      <span class="badge">å…³å¡ <span id="lvLabel">1</span></span>
      <div class="meter"><div class="fill" id="timeFill"></div></div>
      <button class="btn" id="btnHint">æç¤º</button>
      <button class="btn secondary" id="btnShuffle">æ´—ç‰Œ</button>
      <button class="btn ghost" id="btnRestart">é‡å¼€</button>
    </div>
  </header>

  <div class="stage-wrap">
    <div class="stage" id="stage"></div>
  </div>

  <footer>ğŸƒ è§„åˆ™ï¼šç‚¹å‡»ä¸€å¼ å›¾æ¡ˆï¼Œå†ç‚¹å‡»ä»»æ„ä¸€å¼ ç›¸åŒå›¾æ¡ˆå³å¯é…å¯¹æ¶ˆé™¤ï¼ˆæ— éœ€è¿çº¿è§„åˆ™ï¼‰ã€‚</footer>
</div>

<!-- å¼€å§‹ä¸ç»“ç®—å¼¹çª— -->
<div class="overlay" id="startOverlay" style="display:flex;">
  <div class="dialog">
    <h2>ä¸‡åœ£å¤œå¼€å§‹å•¦ ğŸ‘»</h2>
    <p class="dim">é€‰æ‹©å…³å¡å¹¶å¼€å§‹ä½ çš„æ¶ˆé™¤ä¹‹å¤œã€‚å›¾æ ‡ä¼šéšæœºæ•£è½åœ¨åœºæ™¯ä¸­ã€‚</p>
    <div class="levels" id="levels"></div>
  </div>
</div>

<div class="overlay" id="endOverlay">
  <div class="dialog" id="endDialog">
    <h2 id="endTitle">é€šå…³ï¼</h2>
    <p id="endStats" class="dim"></p>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
      <button class="lv" id="btnNext">ä¸‹ä¸€å…³</button>
      <button class="lv" id="btnAgain">å†ç©ä¸€æ¬¡</button>
    </div>
  </div>
</div>

<script>
/** ---------- é…ç½®ï¼ˆæ›´ç®€å•ã€ä½éš¾åº¦ï¼‰ ---------- */
const EMOJIS = ["ğŸƒ","ğŸ‘»","ğŸ¦‡","ğŸ•·ï¸","ğŸ•¸ï¸","ğŸ¬","ğŸ’€","ğŸˆâ€â¬›","ğŸ§™â€â™€ï¸","ğŸ­"];
const LEVELS = [
  { pairs: 12, kinds: 4,  time: 45 },  // 24å¼ 
  { pairs: 16, kinds: 6,  time: 60 },  // 32å¼ 
  { pairs: 20, kinds: 8,  time: 75 },  // 40å¼ 
  { pairs: 24, kinds: 10, time: 90 },  // 48å¼ 
];
const TILE_SIZE = 68; // ç»å¯¹å®šä½å°ºå¯¸ï¼ˆä¸CSSä¸€è‡´ï¼‰

/** ---------- çŠ¶æ€ ---------- */
let state = {
  lv: 0, score: 0, combo: 1, lastMatchTime: 0,
  timeLeft: 0, timerId: null, lock:false,
  picked: null, // {el, v}
  tiles: [],    // æ¯ä¸ª {el, v}
};

const stage = document.getElementById('stage');
const scoreEl = document.getElementById('score');
const comboEl  = document.getElementById('combo');
const lvLabel = document.getElementById('lvLabel');
const timeFill = document.getElementById('timeFill');
const startOverlay = document.getElementById('startOverlay');
const endOverlay = document.getElementById('endOverlay');
const endTitle = document.getElementById('endTitle');
const endStats = document.getElementById('endStats');
const levelsEl = document.getElementById('levels');
const btnHint = document.getElementById('btnHint');
const btnShuffle = document.getElementById('btnShuffle');
const btnRestart = document.getElementById('btnRestart');
const btnNext = document.getElementById('btnNext');
const btnAgain = document.getElementById('btnAgain');

function randInt(n){ return Math.floor(Math.random()*n); }
function randFloat(min,max){ return min + Math.random()*(max-min); }

/** æ„å»ºå…³å¡æŒ‰é’® */
(function initLevels(){
  LEVELS.forEach((lv,i)=>{
    const d=document.createElement('button');
    d.className='lv';
    d.innerHTML=`Lv.${i+1}<br><span class="dim">${lv.pairs*2}å¼  / ${lv.kinds}ç§ / ${lv.time}s</span>`;
    d.onclick=()=>startGame(i);
    levelsEl.appendChild(d);
  });
})();

/** å¼€å§‹/é‡å¼€/ä¸‹ä¸€å…³ */
function startGame(idx){
  state.lv = idx;
  const cfg = LEVELS[idx];
  state.score = 0; state.combo = 1; state.picked = null; state.lock=false;
  buildScene(cfg);
  updateHud();
  startTimer(cfg.time);
  startOverlay.style.display='none';
  endOverlay.style.display='none';
  lvLabel.textContent = (idx+1);
}
btnRestart.onclick = ()=>startGame(state.lv);
btnNext.onclick = ()=> startGame(Math.min(state.lv+1, LEVELS.length-1));
btnAgain.onclick = ()=> startGame(state.lv);

/** éšæœºæ•£è½ç”Ÿæˆï¼šä¸ç½‘æ ¼ï¼Œéšæœºåæ ‡ï¼Œå°½é‡é¿å…ä¸¥é‡é‡å  */
function buildScene(cfg){
  stage.innerHTML='';
  state.tiles = [];
  // ç”Ÿæˆé…å¯¹æ± 
  const pool = [];
  for(let i=0;i<cfg.pairs;i++){
    const kind = randInt(cfg.kinds); // 0..k-1
    pool.push(kind, kind);
  }
  // æ‰“ä¹±
  for(let i=pool.length-1;i>0;i--){ const j=randInt(i+1); [pool[i],pool[j]]=[pool[j],pool[i]]; }

  const pad = 10; // è¾¹è·
  const rect = stage.getBoundingClientRect();
  const W = rect.width, H = rect.height;
  const R = TILE_SIZE;

  function placeOne(el){
    // ç®€å•â€œé˜²é‡å â€ï¼šéšæœºå°è¯•å¤šæ¬¡ï¼Œè¦æ±‚ä¸å·²æ”¾ç½®ä¸­å¿ƒè·ç¦»>é˜ˆå€¼
    const tries = 50;
    let x=0,y=0,ok=false;
    for(let t=0;t<tries;t++){
      x = randFloat(pad, Math.max(pad, W - R - pad));
      y = randFloat(pad, Math.max(pad, H - R - pad));
      ok = state.tiles.every(ti=>{
        const b = ti.el.getBoundingClientRect();
        const cx = b.left + b.width/2, cy = b.top + b.height/2;
        const nx = stage.getBoundingClientRect().left + x + R/2;
        const ny = stage.getBoundingClientRect().top  + y + R/2;
        const dist = Math.hypot(nx-cx, ny-cy);
        return dist > R*0.9; // å…è®¸è½»å¾®é‡å ï¼Œä½†å°½é‡åˆ†æ•£
      });
      if(ok) break;
    }
    el.style.left = x+'px'; el.style.top = y+'px';
  }

  // æ”¾ç½®
  for(let i=0;i<pool.length;i++){
    const v = pool[i];
    const el = document.createElement('div');
    el.className='tile';
    el.textContent = EMOJIS[v];
    el.dataset.v = v;
    el.style.width = el.style.height = TILE_SIZE+'px';
    el.onclick = ()=>onPick(el, v);
    stage.appendChild(el);
    placeOne(el);
    state.tiles.push({el, v});
  }
}

/** ç‚¹å‡»é€»è¾‘ï¼šåªè¦ç›¸åŒå³æ¶ˆé™¤ */
function onPick(el, v){
  if(state.lock) return;
  if(!state.picked){
    state.picked = {el, v};
    el.classList.add('selected');
    return;
  }
  // ç‚¹åˆ°è‡ªå·±åˆ™å¿½ç•¥
  if(state.picked.el === el) return;

  // ä¸åŒï¼šåˆ‡æ¢é€‰æ‹©
  if(state.picked.v !== v){
    state.picked.el.classList.remove('selected');
    state.picked = {el, v};
    el.classList.add('selected');
    return;
  }

  // ç›¸åŒï¼šç›´æ¥æ¶ˆé™¤
  state.lock = true;
  const a = state.picked.el, b = el;
  a.classList.remove('selected');
  a.classList.add('pop'); b.classList.add('pop');

  setTimeout(()=>{
    a.remove(); b.remove();
    state.tiles = state.tiles.filter(t=>t.el!==a && t.el!==b);
    state.lock = false; state.picked = null;

    // è®¡åˆ†/è¿å‡»
    const now = performance.now();
    state.combo = (now - state.lastMatchTime < 1800) ? Math.min(state.combo+1, 10) : 1;
    state.lastMatchTime = now;
    state.score += 10 * state.combo;
    updateHud();

    if(state.tiles.length===0){
      showEnd(true);
    }
  }, 260);
}

/** æç¤ºï¼šé«˜äº®ä»»æ„ä¸€å¯¹ç›¸åŒå›¾æ¡ˆ */
function hint(){
  const map = new Map();
  for(const t of state.tiles){
    if(!map.has(t.v)) map.set(t.v, []);
    map.get(t.v).push(t.el);
  }
  for(const [v, list] of map){
    if(list.length>=2){
      list[0].classList.add('pulse'); list[1].classList.add('pulse');
      setTimeout(()=>{list[0]?.classList.remove('pulse'); list[1]?.classList.remove('pulse');}, 1000);
      return;
    }
  }
}

/** æ´—ç‰Œï¼šä»…é‡æ–°éšæœºä½ç½® */
function shuffle(){
  const rect = stage.getBoundingClientRect(), W = rect.width, H = rect.height, R=TILE_SIZE, pad=10;
  for(const t of state.tiles){
    const x = randFloat(pad, Math.max(pad, W - R - pad));
    const y = randFloat(pad, Math.max(pad, H - R - pad));
    t.el.style.left = x+'px'; t.el.style.top = y+'px';
  }
}

/** è®¡æ—¶å™¨/HUD/ç»“ç®— */
function startTimer(total){
  clearInterval(state.timerId);
  state.timeLeft = total;
  timeFill.style.width='100%';
  state.timerId = setInterval(()=>{
    state.timeLeft -= 1;
    timeFill.style.width = `${(state.timeLeft/total)*100}%`;
    if(state.timeLeft<=0){
      clearInterval(state.timerId);
      showEnd(false);
    }
  },1000);
}
function updateHud(){
  scoreEl.textContent = `å¾—åˆ† ${state.score}`;
  comboEl.textContent = `è¿å‡» x${state.combo}`;
}
function showEnd(win){
  endTitle.textContent = win ? 'é€šå…³ï¼ğŸ‰' : 'æ—¶é—´åˆ°ï¼';
  endStats.textContent = `å¾—åˆ†ï¼š${state.score}ï½œè¿å‡»ï¼šx${state.combo}`;
  endOverlay.style.display='flex';
  clearInterval(state.timerId);
}

/** äº‹ä»¶ç»‘å®š */
btnHint.onclick = ()=>hint();
btnShuffle.onclick = ()=>shuffle();
btnRestart.onclick = ()=>startGame(state.lv);

/** å…¥å£ */
window.addEventListener('load', ()=>{
  // å…³å¡æŒ‰é’®ï¼ˆå·²åˆ›å»ºï¼‰ï¼Œç­‰å¾…é€‰æ‹©
});
</script>
</body>
</html>
