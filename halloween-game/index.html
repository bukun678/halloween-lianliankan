<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>åœ£è¯èŠ‚é…å¯¹æŒ‘æˆ˜</title>
<style>
  :root{
    --bg:#071116; --text:#f7f7fb;
    --panel:#0d2b2f; --panel2:#0a1f22;
    --tile:#0f2e33; --tile-hover:#154048; --tile-selected:#1a5b66;
    --violet:#9de6ff; --green:#22c55e; --amber:#f59e0b; --red:#ef4444;
    --shadow:0 10px 30px rgba(0,0,0,.45);
  }
  html,body{height:100%;margin:0;background:
    radial-gradient(1200px 700px at 70% -200px,#08323a 0%,#052027 40%,#04141a 100%),
    var(--bg); color:var(--text); font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Apple Color Emoji,Noto Color Emoji;}
  *{box-sizing:border-box}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 12px}
  .title{display:flex;gap:10px;align-items:center;font-weight:900;font-size:clamp(18px,2.6vw,26px)}
  .panel{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid #194a51;border-radius:16px;padding:12px 14px;box-shadow:var(--shadow);display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .badge{padding:8px 12px;border-radius:999px;background:#0c2326;border:1px solid #1a4f56;font-weight:800}
  .btn{appearance:none;border:0;background:linear-gradient(180deg,#ffd0d0,#ff9b9b);color:#4b1111;padding:10px 14px;border-radius:12px;font-weight:900;cursor:pointer;box-shadow:inset 0 -2px 0 rgba(0,0,0,.15),0 8px 16px rgba(0,0,0,.25);transition:.15s transform}
  .btn:active{transform:translateY(1px)}
  .btn.ghost{background:#14343a;color:#d7fbff;border:1px solid #1b5e67}
  .btn.tiny{padding:8px 10px;font-size:13px}
  .meter{position:relative;height:14px;background:#0b2024;border:1px solid #1a4f56;border-radius:999px;overflow:hidden;min-width:220px}
  .fill{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,var(--green),#86efac);transition:width .35s ease}
  .stage-wrap{margin:14px 0}
  .stage{
    position:relative;width:100%;height: clamp(420px, 60vw, 640px);
    background:linear-gradient(180deg,rgba(14,47,53,.65),rgba(6,22,25,.65));
    border:1px solid #1a4f56;border-radius:18px;box-shadow:var(--shadow);overflow:hidden;
  }
  .tile{
    position:absolute;display:flex;align-items:center;justify-content:center;
    width:68px;height:68px;font-size:38px;line-height:1;
    background:var(--tile);border:1px solid #1a4f56;border-radius:18px;cursor:pointer;
    transition:.12s transform,.12s filter,.12s box-shadow,.12s background;user-select:none;
  }
  .tile:hover{background:var(--tile-hover)}
  .tile.selected{background:var(--tile-selected);box-shadow:0 0 0 3px var(--violet) inset,0 0 14px rgba(157,230,255,.35)}
  .tile.pop{animation:pop .35s both}
  @keyframes pop{0%{transform:scale(1)}30%{transform:scale(1.15)}100%{transform:scale(.1);opacity:0}}
  .overlay{position:fixed;inset:0;background:rgba(3,10,12,.75);display:none;align-items:center;justify-content:center;padding:20px;z-index:10}
  .dialog{max-width:640px;width:100%;background:linear-gradient(180deg,#0f2e33,#0a1f22);border:1px solid #1a4f56;border-radius:18px;box-shadow:var(--shadow);padding:22px}
  .levels{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-top:10px}
  .lv{padding:14px;border-radius:12px;background:#0c2326;border:1px solid #1a4f56;cursor:pointer;text-align:center;font-weight:900}
  .shake{animation:shake .4s linear infinite}
  @keyframes shake{0%,100%{transform:translate(0,0)}20%{transform:translate(1px,-1px)}40%{transform:translate(-1px,1px)}60%{transform:translate(1px,1px)}80%{transform:translate(-1px,-1px)}}
</style>
</head>
<body>
<audio id="bgmTag" preload="auto" loop playsinline muted src="/bgm.mp3?v=20251103"></audio>

<div class="container">
  <header>
    <div class="title"><span>ğŸ„</span><span id="modeLabel">åœ£è¯èŠ‚é…å¯¹æŒ‘æˆ˜</span></div>
    <div class="panel">
      <span class="badge" id="score">å¾—åˆ† 0</span>
      <span class="badge">å…³å¡ <span id="lvLabel">1</span></span>
      <div class="meter"><div class="fill" id="timeFill"></div></div>
      <span class="badge" id="timeLabel">å€’è®¡æ—¶ 0s</span>
      <button class="btn" id="btnSelect">é€‰å…³</button>
      <button class="btn tiny ghost" id="btnBgm">ğŸ”ˆ éŸ³ä¹å¼€</button>
    </div>
  </header>

  <div class="stage-wrap"><div class="stage" id="stage"></div></div>
  <footer>ğŸ§‘â€ğŸ„ ç‚¹å‡»ä¸¤å¼ ç›¸åŒå›¾æ¡ˆå³å¯é…å¯¹æ¶ˆé™¤ã€‚</footer>
</div>

<div class="overlay" id="startOverlay" style="display:flex;">
  <div class="dialog">
    <h2>é€‰æ‹©æ¨¡å¼å¼€å§‹ ğŸ…</h2>
    <div class="levels">
      <button class="lv" id="btnEasy">ğŸ„ ç®€å•æ¨¡å¼</button>
      <button class="lv" id="btnNormal">ğŸ ä¸€èˆ¬æ¨¡å¼</button>
      <button class="lv" id="btnHard">â„ï¸ å›°éš¾æ¨¡å¼</button>
    </div>
  </div>
</div>

<div class="overlay" id="endOverlay" style="display:none;">
  <div class="dialog" id="endDialog">
    <h2 id="endTitle"></h2>
    <p id="endStats" style="opacity:.85"></p>
    <div id="successPanel">
      <div style="margin-top:10px;">
        <input id="nameInput" type="text" placeholder="è¾“å…¥åå­—/æ˜µç§°ï¼ˆå¯ç•™ç©ºï¼‰" maxlength="20" style="padding:8px 10px;border-radius:8px;border:1px solid #1a4f56;background:#0c2326;color:#fff;font-weight:600;width:60%;">
        <button class="btn ghost" id="btnUpdateCert">æ›´æ–°è¯ä¹¦</button>
      </div>
      <div style="margin-top:10px;">
        <a class="btn" id="btnDownload" download="åœ£è¯èŠ‚è¯ä¹¦.png">ä¸‹è½½è¯ä¹¦</a>
        <button class="btn" id="btnNext">ä¸‹ä¸€å…³</button>
        <button class="btn" id="btnHome">è¿”å›é¦–é¡µ</button>
      </div>
      <div class="cert-wrap" style="margin-top:10px;"><img id="certImg" alt="è¯ä¹¦é¢„è§ˆ" style="width:100%;border-radius:12px;border:1px solid #1a4f56;display:block"/></div>
    </div>
    <div id="failPanel" style="display:none;text-align:center;margin-top:20px;">
      <button class="btn" id="btnRetry">å†æ¥ä¸€æ¬¡</button>
    </div>
  </div>
</div>

<script>
// === æ¸…è„†éŸ³æ•ˆ ===
let AC; function ensureAC(){ if(!AC){ const C=window.AudioContext||window.webkitAudioContext; AC=new C(); } if(AC.state==='suspended') AC.resume(); }
function blip({fStart=1900,fEnd=900,dur=70,type='square',gain=0.045,when=0}){ensureAC();const t0=AC.currentTime+when/1000;const o=AC.createOscillator();const g=AC.createGain();o.type=type;o.frequency.setValueAtTime(fStart,t0);o.frequency.exponentialRampToValueAtTime(fEnd,t0+dur/1000);g.gain.setValueAtTime(0,t0);g.gain.linearRampToValueAtTime(gain,t0+0.008);g.gain.exponentialRampToValueAtTime(1e-5,t0+dur/1000);o.connect(g).connect(AC.destination);o.start(t0);o.stop(t0+dur/1000+.02);}
function sfxClick(){blip({fStart:2000,fEnd:1200,dur:60,type:'triangle',gain:.05});blip({fStart:3000,fEnd:1800,dur:40,type:'square',gain:.03,when:10});}
function sfxWin(){[800,1000,1200,1600].forEach((f,i)=>blip({fStart:f,fEnd:f/1.5,dur:120,type:'triangle',gain:.05,when:i*100}));}

// === BGM ===
const btnBgm=document.getElementById('btnBgm'),bgmTag=document.getElementById('bgmTag');
const BGM={enabled:true,setBtn(){btnBgm.textContent=this.enabled?'ğŸ”ˆ éŸ³ä¹å¼€':'ğŸ”‡ éŸ³ä¹å…³';},async ensurePlay(){if(!this.enabled)return;try{bgmTag.muted=false;bgmTag.volume=.35;if(bgmTag.readyState<2)bgmTag.load();await bgmTag.play();}catch(_){}},pause(){bgmTag.pause();},toggle(){this.enabled=!this.enabled;this.setBtn();this.enabled?this.ensurePlay():this.pause();}};
BGM.setBtn();document.addEventListener('DOMContentLoaded',()=>{bgmTag.muted=true;bgmTag.volume=0;bgmTag.play().catch(()=>{});});
['pointerdown','touchstart','click'].forEach(ev=>{document.addEventListener(ev,()=>BGM.ensurePlay(),{once:true,passive:true});});
btnBgm.onclick=()=>BGM.toggle();

// === æ¸¸æˆé€»è¾‘ ===
const EMOJIS=["ğŸ…","ğŸ„","ğŸ","ğŸ€","ğŸ§¦","ğŸ•¯ï¸","ğŸª","ğŸ¦Œ","ğŸ‰","ğŸ¬","â›„","â„ï¸","ğŸŒŸ","ğŸ·","ğŸ¥›","ğŸ§¸","ğŸ””","ğŸª…","ğŸª„","ğŸ—"];
const MODES={easy:{base:{pairs:12,kinds:4,time:40}},normal:{base:{pairs:16,kinds:6,time:35}},hard:{base:{pairs:20,kinds:8,time:30}}};
const stage=document.getElementById('stage'),scoreEl=document.getElementById('score'),lvLabel=document.getElementById('lvLabel'),timeFill=document.getElementById('timeFill'),timeLabel=document.getElementById('timeLabel'),modeLabel=document.getElementById('modeLabel');
const startOverlay=document.getElementById('startOverlay'),endOverlay=document.getElementById('endOverlay');
let state={mode:MODES.easy,lv:1,score:0,tiles:[],timeLeft:0,lock:false,picked:null,startTime:0};
document.getElementById('btnEasy').onclick=()=>startMode(MODES.easy,'ç®€å•æ¨¡å¼');
document.getElementById('btnNormal').onclick=()=>startMode(MODES.normal,'ä¸€èˆ¬æ¨¡å¼');
document.getElementById('btnHard').onclick=()=>startMode(MODES.hard,'å›°éš¾æ¨¡å¼');
document.getElementById('btnSelect').onclick=()=>{startOverlay.style.display='flex';endOverlay.style.display='none';stage.innerHTML='';};
function startMode(mode,title){state.mode=mode;state.lv=1;modeLabel.textContent=`åœ£è¯èŠ‚é…å¯¹æŒ‘æˆ˜ Â· ${title}`;startOverlay.style.display='none';startLevel();}
function startLevel(){stage.innerHTML='';state.score=0;scoreEl.textContent='å¾—åˆ† 0';lvLabel.textContent=state.lv;buildTiles();startTimer();}
function buildTiles(){const pool=[];const kinds=state.mode.base.kinds;for(let i=0;i<state.mode.base.pairs;i++){const k=Math.floor(Math.random()*kinds);pool.push(k,k);}for(let i=pool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pool[i],pool[j]]=[pool[j],pool[i]];}const rect=stage.getBoundingClientRect(),W=rect.width,H=rect.height;pool.forEach(v=>{const el=document.createElement('div');el.className='tile';el.textContent=EMOJIS[v%EMOJIS.length];el.style.left=Math.random()*(W-70)+'px';el.style.top=Math.random()*(H-70)+'px';el.onclick=()=>onPick(el,v);stage.appendChild(el);state.tiles.push({el,v});});}
function onPick(el,v){sfxClick();if(state.lock)return;if(!state.picked){state.picked={el,v};el.classList.add('selected');return;}if(state.picked.el===el)return;if(state.picked.v!==v){state.picked.el.classList.remove('selected');state.picked={el,v};el.classList.add('selected');return;}state.lock=true;const a=state.picked.el,b=el;a.classList.remove('selected');a.classList.add('pop');b.classList.add('pop');setTimeout(()=>{a.remove();b.remove();state.tiles=state.tiles.filter(t=>t.el!==a&&t.el!==b);state.lock=false;state.picked=null;state.score+=10;scoreEl.textContent=`å¾—åˆ† ${state.score}`;if(state.tiles.length===0)endGame(true);},250);}
let timer=null;function startTimer(){clearInterval(timer);state.timeLeft=state.mode.base.time;timeFill.style.width='100%';timer=setInterval(()=>{state.timeLeft--;const pct=(state.timeLeft/state.mode.base.time)*100;timeFill.style.width=pct+'%';timeLabel.textContent=`å€’è®¡æ—¶ ${state.timeLeft}s`;if(state.timeLeft<=0){clearInterval(timer);endGame(false);}},1000);}
function endGame(win){clearInterval(timer);endOverlay.style.display='flex';const endTitle=document.getElementById('endTitle');const endStats=document.getElementById('endStats');const successPanel=document.getElementById('successPanel');const failPanel=document.getElementById('failPanel');if(win){sfxWin();endTitle.textContent='é€šå…³ï¼ğŸ';endStats.textContent=`å…³å¡ ${state.lv} ï½œ å¾—åˆ† ${state.score}`;successPanel.style.display='block';failPanel.style.display='none';}else{endTitle.textContent='æ—¶é—´åˆ°ï¼ğŸ…';endStats.textContent=`å¾ˆé—æ†¾ï¼Œæœ¬å…³æœªé€šå…³ã€‚`;successPanel.style.display='none';failPanel.style.display='block';}}
document.getElementById('btnRetry').onclick=()=>{endOverlay.style.display='none';startLevel();};
document.getElementById('btnHome').onclick=()=>{endOverlay.style.display='none';startOverlay.style.display='flex';};
document.getElementById('btnNext').onclick=()=>{state.lv++;endOverlay.style.display='none';startLevel();};
</script>
</body>
</html>
